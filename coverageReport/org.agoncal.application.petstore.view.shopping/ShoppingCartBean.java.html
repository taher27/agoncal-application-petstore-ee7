<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ShoppingCartBean.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Petstore application using Java EE 7</a> &gt; <a href="index.source.html" class="el_package">org.agoncal.application.petstore.view.shopping</a> &gt; <span class="el_source">ShoppingCartBean.java</span></div><h1>ShoppingCartBean.java</h1><pre class="source lang-java linenums">package org.agoncal.application.petstore.view.shopping;

import org.agoncal.application.petstore.model.*;
import org.agoncal.application.petstore.service.CatalogService;
import org.agoncal.application.petstore.service.PurchaseOrderService;
import org.agoncal.application.petstore.util.Loggable;
import org.agoncal.application.petstore.view.AbstractBean;
import org.agoncal.application.petstore.view.CatchException;
import org.agoncal.application.petstore.view.LoggedIn;

import javax.enterprise.context.Conversation;
import javax.enterprise.context.ConversationScoped;
import javax.enterprise.inject.Instance;
import javax.inject.Inject;
import javax.inject.Named;
import java.io.Serializable;
import java.util.ArrayList;
import java.util.List;

/**
 * @author Antonio Goncalves
 *         http://www.antoniogoncalves.org
 *         --
 */

@Named
@ConversationScoped
@Loggable
@CatchException
<span class="nc" id="L30">public class ShoppingCartBean extends AbstractBean implements Serializable {</span>

    // ======================================
    // =             Attributes             =
    // ======================================

    @Inject
    @LoggedIn
    private Instance&lt;Customer&gt; loggedInCustomer;
    @Inject
    private CatalogService catalogBean;
    @Inject
    private PurchaseOrderService orderBean;
    @Inject
    private Conversation conversation;

    private List&lt;ShoppingCartItem&gt; cartItems;
<span class="nc" id="L47">    private CreditCard creditCard = new CreditCard();</span>
    private PurchaseOrder order;

    // ======================================
    // =              Public Methods        =
    // ======================================

    public String addItemToCart() {
<span class="nc" id="L55">        Item item = catalogBean.findItem(getParamId(&quot;itemId&quot;));</span>

        // Start conversation
<span class="nc bnc" id="L58" title="All 2 branches missed.">        if (conversation.isTransient()) {</span>
<span class="nc" id="L59">            cartItems = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L60">            conversation.begin();</span>
        }

<span class="nc" id="L63">        boolean itemFound = false;</span>
<span class="nc bnc" id="L64" title="All 2 branches missed.">        for (ShoppingCartItem cartItem : cartItems) {</span>
            // If item already exists in the shopping cart we just change the quantity
<span class="nc bnc" id="L66" title="All 2 branches missed.">            if (cartItem.getItem().equals(item)) {</span>
<span class="nc" id="L67">                cartItem.setQuantity(cartItem.getQuantity() + 1);</span>
<span class="nc" id="L68">                itemFound = true;</span>
            }
<span class="nc" id="L70">        }</span>
<span class="nc bnc" id="L71" title="All 2 branches missed.">        if (!itemFound)</span>
            // Otherwise it's added to the shopping cart
<span class="nc" id="L73">            cartItems.add(new ShoppingCartItem(item, 1));</span>

<span class="nc" id="L75">        return &quot;showcart.faces&quot;;</span>
    }

    public String removeItemFromCart() {
<span class="nc" id="L79">        Item item = catalogBean.findItem(getParamId(&quot;itemId&quot;));</span>

<span class="nc bnc" id="L81" title="All 2 branches missed.">        for (ShoppingCartItem cartItem : cartItems) {</span>
<span class="nc bnc" id="L82" title="All 2 branches missed.">            if (cartItem.getItem().equals(item)) {</span>
<span class="nc" id="L83">                cartItems.remove(cartItem);</span>
<span class="nc" id="L84">                return null;</span>
            }
<span class="nc" id="L86">        }</span>

<span class="nc" id="L88">        return null;</span>
    }

    public String updateQuantity() {
<span class="nc" id="L92">        return null;</span>
    }

    public String checkout() {
<span class="nc" id="L96">        return &quot;confirmorder.faces&quot;;</span>
    }

    public String confirmOrder() {
<span class="nc" id="L100">        order = orderBean.createOrder(getCustomer(), creditCard, getCartItems());</span>
<span class="nc" id="L101">        cartItems.clear();</span>

        // Stop conversation
<span class="nc bnc" id="L104" title="All 2 branches missed.">        if (!conversation.isTransient()) {</span>
<span class="nc" id="L105">            conversation.end();</span>
        }

<span class="nc" id="L108">        return &quot;orderconfirmed.faces&quot;;</span>
    }

    public List&lt;ShoppingCartItem&gt; getCartItems() {
<span class="nc" id="L112">        return cartItems;</span>
    }

    public boolean shoppingCartIsEmpty() {
<span class="nc bnc" id="L116" title="All 4 branches missed.">        return getCartItems() == null || getCartItems().size() == 0;</span>
    }


    public Float getTotal() {

<span class="nc bnc" id="L122" title="All 4 branches missed.">        if (cartItems == null || cartItems.isEmpty())</span>
<span class="nc" id="L123">            return 0f;</span>

<span class="nc" id="L125">        Float total = 0f;</span>

        // Sum up the quantities
<span class="nc bnc" id="L128" title="All 2 branches missed.">        for (ShoppingCartItem cartItem : cartItems) {</span>
<span class="nc" id="L129">            total += (cartItem.getSubTotal());</span>
<span class="nc" id="L130">        }</span>
<span class="nc" id="L131">        return total;</span>
    }

    // ======================================
    // =         Getters &amp; setters          =
    // ======================================

    public Customer getCustomer() {
<span class="nc" id="L139">        return loggedInCustomer.get();</span>
    }


    public CreditCard getCreditCard() {
<span class="nc" id="L144">        return creditCard;</span>
    }

    public void setCreditCard(CreditCard creditCard) {
<span class="nc" id="L148">        this.creditCard = creditCard;</span>
<span class="nc" id="L149">    }</span>

    public PurchaseOrder getOrder() {
<span class="nc" id="L152">        return order;</span>
    }

    public void setOrder(PurchaseOrder order) {
<span class="nc" id="L156">        this.order = order;</span>
<span class="nc" id="L157">    }</span>

    public Conversation getConversation() {
<span class="nc" id="L160">        return conversation;</span>
    }

    public CreditCardType[] getCreditCardTypes() {
<span class="nc" id="L164">        return CreditCardType.values();</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>